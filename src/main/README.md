# LanFile_PC 项目主进程模块分析

## 主进程目录结构分析

`src/main` 目录包含了 Electron 应用的主进程代码，主要负责与操作系统交互、管理窗口以及提供 IPC 通信功能。以下是主要文件及其功能分析：

### 核心文件

#### `index.ts`

- **主入口文件**：初始化应用、创建主窗口、设置 IPC 处理程序
- **应用生命周期管理**：处理应用启动、关闭等事件
- **全局服务初始化**：启动网络服务、信令服务等核心服务

#### 网络通信相关文件

- **`network.ts`**：处理网络连接测试、UDP 通信等底层网络功能
- **`signaling.ts`**：实现 WebSocket 信令服务，处理设备间通信和连接初始化
- **`webrtc.ts`**：处理 WebRTC 相关功能，实现点对点文件传输
- **`mdns.ts`**：负责局域网内设备的自动发现

### 服务模块 (`services` 目录)

#### 核心服务

- **`MDNSService.ts`**：基于 Bonjour 的服务发现，用于自动发现局域网内的设备
- **`WebSocketSignalingService.ts`**：实现信令服务器功能，处理设备之间的消息传递
- **`HeartbeatService.ts`**：心跳检测服务，维持设备之间的连接状态
- **`NetworkService.ts`**：提供网络层通信功能，支持 UDP 广播发现等功能

#### 辅助服务

- **`LogService.ts`**：日志服务，记录应用运行时信息
- **`DirectIPService.ts`**：直接 IP 连接服务，提供 TCP 连接功能
- **`ZeroconfService.ts`**：零配置网络服务，简化设备发现
- **`api.ts`**：HTTP 请求处理服务

### 其他辅助文件

- **`store/index.ts`**：应用配置存储，基于 electron-store
- **`types/global.d.ts`** 和 **`types.d.ts`**：全局类型定义

## 主进程核心功能

### 1. 设备发现机制

应用使用多种方式实现设备发现：

- **MDNS/Bonjour**：零配置网络服务发现协议
- **UDP 广播**：通过网络广播发现设备
- **WebSocket 信令服务器**：维护连接的设备列表

### 2. 文件传输实现

- **WebRTC 数据通道**：点对点高效传输
- **直接 TCP/IP 连接**：作为备选传输方式
- **分块传输**：支持大文件的分块传输

### 3. 连接管理

- **心跳检测**：定期检查设备在线状态
- **自动重连**：断线自动重连机制
- **防火墙配置**：自动处理端口访问权限

### 4. 安全性考虑

- 实现了端口动态分配，避免端口冲突
- 在文件传输前进行连接检测
- 提供设备验证机制

## 技术栈优势

- **WebRTC**：点对点直接传输，减少服务器依赖
- **多重发现机制**：增强设备发现的稳健性
- **可配置架构**：支持多种传输方式和配置选项

## 潜在优化方向

1. 增强设备离线检测的精确性
2. 优化大文件传输的内存使用
3. 改进信令服务的鲁棒性，处理更多边缘情况
4. 添加数据加密层，提高传输安全性
5. 实现传输速度自适应算法
